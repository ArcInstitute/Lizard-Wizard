process {
    conda         = "conda_env.yml"
    errorStrategy = { task.exitStatus in ((130..145) + 104 + 125) ? "retry" : "finish" }
    maxRetries    = 0
    maxErrors     = "-1"

    cpus = { check_max( 1, "cpus" ) }
    memory = { check_max( 6.GB, "memory" ) }
    time = { check_max( 2.h, "time" ) }

    withLabel:process_low {
        cpus = { check_max( 4, "cpus" ) }
        memory = { check_max( 8.GB * task.attempt, "memory" ) }
        time = { check_max( 6.h * task.attempt, "time" ) }
    }
    withLabel:process_medium {
        cpus = { check_max( 30, "cpus" ) }
        memory = { check_max( 64.GB * task.attempt, "memory" ) }
        time = { check_max( 24.h * task.attempt, "time" ) }
    }
    withLabel:process_high {
        cpus = { check_max( 60, "cpus" ) }
        memory = { check_max( 128.GB * task.attempt, "memory" ) }
        time = { check_max( 72.h * task.attempt, "time" ) }
    }
}

